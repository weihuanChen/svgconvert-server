# API ç«¯ç‚¹é€Ÿè§ˆè¡¨

## ğŸ“ æ‰€æœ‰å¯ç”¨ç«¯ç‚¹

### åŸºç¡€ç«¯ç‚¹

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | è®¤è¯ | çŠ¶æ€ç  |
|------|------|------|------|--------|
| `GET` | `/` | è·å–æœåŠ¡ä¿¡æ¯ | âŒ | 200 |
| `GET` | `/health` | å¥åº·æ£€æŸ¥ | âŒ | 200/503 |

---

### è½¬æ¢ç›¸å…³ç«¯ç‚¹

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | è®¤è¯ | Content-Type |
|------|------|------|------|-------------|
| `POST` | `/api/upload` | ä¸Šä¼ æ–‡ä»¶å¹¶å¼€å§‹è½¬æ¢ | âŒ | multipart/form-data |
| `GET` | `/api/status/:taskId` | æŸ¥è¯¢è½¬æ¢çŠ¶æ€ | âŒ | application/json |
| `GET` | `/api/download/:taskId` | ä¸‹è½½è½¬æ¢ç»“æœ | âŒ | image/* / application/pdf |
| `DELETE` | `/api/cleanup/:taskId` | æ‰‹åŠ¨æ¸…ç†ä»»åŠ¡ | âŒ | application/json |

---

### é˜Ÿåˆ—ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰

| æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ | è®¤è¯ | å‰ç½®æ¡ä»¶ |
|------|------|------|------|---------|
| `POST` | `/api/queue/process` | å¤„ç†é˜Ÿåˆ—ä»»åŠ¡ | âŒ | ENABLE_QUEUE_MODE=true |
| `GET` | `/api/queue/status/:taskId` | æŸ¥è¯¢é˜Ÿåˆ—ä»»åŠ¡çŠ¶æ€ | âŒ | ENABLE_QUEUE_MODE=true |

---

## ğŸ“Š è¯·æ±‚/å“åº”é€ŸæŸ¥è¡¨

### ä¸Šä¼ ç«¯ç‚¹ - POST /api/upload

**è¯·æ±‚å‚æ•°ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‚æ•°                â”‚ ç±»å‹     â”‚ å¿…éœ€   â”‚ è¯´æ˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ file                â”‚ File     â”‚ âœ…    â”‚ è¾“å…¥æ–‡ä»¶ (SVG/PNG/JPG/PDF)      â”‚
â”‚ outputFormat        â”‚ string   â”‚ âœ…    â”‚ è¾“å‡ºæ ¼å¼ (svg/png/jpg/pdf)      â”‚
â”‚ width               â”‚ integer  â”‚ âŒ    â”‚ è¾“å‡ºå®½åº¦ï¼ˆåƒç´ ï¼‰                â”‚
â”‚ height              â”‚ integer  â”‚ âŒ    â”‚ è¾“å‡ºé«˜åº¦ï¼ˆåƒç´ ï¼‰                â”‚
â”‚ quality             â”‚ integer  â”‚ âŒ    â”‚ JPGè´¨é‡ (1-100, é»˜è®¤:85)        â”‚
â”‚ backgroundColor     â”‚ string   â”‚ âŒ    â”‚ èƒŒæ™¯è‰² (#ffffff/transparent)    â”‚
â”‚ maintainAspectRatio â”‚ boolean  â”‚ âŒ    â”‚ ä¿æŒå®½é«˜æ¯” (é»˜è®¤:true)          â”‚
â”‚ colors              â”‚ integer  â”‚ âŒ    â”‚ SVGçŸ¢é‡åŒ–é¢œè‰²æ•° (2-256)         â”‚
â”‚ smoothing           â”‚ float    â”‚ âŒ    â”‚ å¹³æ»‘åº¦ (0.0-1.0)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å“åº”ï¼ˆæˆåŠŸ 200ï¼‰ï¼š**
```json
{
  "taskId": "uuid",
  "status": "PENDING",
  "message": "æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"
}
```

**å“åº”ï¼ˆé”™è¯¯ç¤ºä¾‹ï¼‰ï¼š**
```
400: no_file / file_too_large / invalid_format / invalid_output_format / invalid_params
500: upload_failed / internal_error
```

---

### çŠ¶æ€æŸ¥è¯¢ç«¯ç‚¹ - GET /api/status/:taskId

**URL å‚æ•°ï¼š**
```
taskId: ä¸Šä¼ æ—¶è¿”å›çš„ä»»åŠ¡ ID (UUID)
```

**æŸ¥è¯¢å‚æ•°ï¼š**
```
æ— 
```

**å“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "taskId": "uuid",
  "status": "PENDING|PROCESSING|COMPLETED|ERROR",
  "error": "null|é”™è¯¯ä¿¡æ¯"
}
```

**å¯èƒ½çš„çŠ¶æ€æµè½¬ï¼š**
```
PENDING â†’ PROCESSING â†’ COMPLETED
       â†“ (å¯èƒ½è·³è¿‡PENDING)
       PROCESSING â†’ ERROR
```

---

### ä¸‹è½½ç«¯ç‚¹ - GET /api/download/:taskId

**URL å‚æ•°ï¼š**
```
taskId: ä¸Šä¼ æ—¶è¿”å›çš„ä»»åŠ¡ ID (UUID)
```

**å“åº”å¤´ï¼ˆæˆåŠŸ 200ï¼‰ï¼š**
```
Content-Type: image/png | image/jpeg | image/svg+xml | application/pdf
Content-Disposition: attachment; filename="converted_[taskId].[ext]"
Content-Length: [æ–‡ä»¶å­—èŠ‚æ•°]
```

**å“åº”ä½“ï¼š**
```
äºŒè¿›åˆ¶æ–‡ä»¶å†…å®¹
```

**å¯èƒ½çš„é”™è¯¯ï¼š**
```
400: not_ready / conversion_failed
404: task_not_found / file_not_found
500: download_failed
```

---

### æ¸…ç†ç«¯ç‚¹ - DELETE /api/cleanup/:taskId

**URL å‚æ•°ï¼š**
```
taskId: ä¸Šä¼ æ—¶è¿”å›çš„ä»»åŠ¡ ID (UUID)
```

**å“åº”ï¼ˆ200ï¼‰ï¼š**
```json
{
  "message": "ä»»åŠ¡å·²æ¸…ç†",
  "taskId": "uuid"
}
```

**é”™è¯¯å“åº”ï¼š**
```
404: task_not_found
```

---

## ğŸ”„ å…¸å‹å·¥ä½œæµ

```
1. POST /api/upload
   â†“
   è¿”å› taskId
   â†“
2. GET /api/status/:taskId (è½®è¯¢)
   â†“
   å½“ status === "COMPLETED"
   â†“
3. GET /api/download/:taskId
   â†“
   è·å–æ–‡ä»¶
   â†“
4. DELETE /api/cleanup/:taskId (å¯é€‰)
   â†“
   æ¸…ç†å®Œæˆ
```

---

## ğŸŒ æœ¬åœ°åŒ–æ”¯æŒ

æ‰€æœ‰ç«¯ç‚¹æ”¯æŒé€šè¿‡ `Accept-Language` è¯·æ±‚å¤´è¿›è¡Œæœ¬åœ°åŒ–ï¼š

```
Accept-Language: zh  â†’ ä¸­æ–‡
Accept-Language: ja  â†’ æ—¥æ–‡
Accept-Language: en  â†’ è‹±æ–‡
```

ç¤ºä¾‹ï¼š
```bash
curl http://localhost:3000/api/status/TASK_ID \
  -H "Accept-Language: zh"
```

---

## âš™ï¸ é…ç½®ç¯å¢ƒå˜é‡

### æ ¸å¿ƒé…ç½®

```bash
PORT=3000                           # æœåŠ¡ç«¯å£
NODE_ENV=development                # ç¯å¢ƒ
TEMP_DIR=./temp                     # ä¸´æ—¶æ–‡ä»¶ç›®å½•
MAX_FILE_SIZE=20971520              # æœ€å¤§æ–‡ä»¶å¤§å° (20MB)
CLEANUP_INTERVAL_MINUTES=5          # æ¸…ç†é—´éš”
FILE_RETENTION_MINUTES=30           # æ–‡ä»¶ä¿ç•™æ—¶é—´
ALLOWED_ORIGINS=*                   # CORS å…è®¸çš„æº
```

### R2 å­˜å‚¨é…ç½®

```bash
R2_ACCOUNT_ID=your-account-id
R2_ACCESS_KEY_ID=your-access-key
R2_SECRET_ACCESS_KEY=your-secret
R2_BUCKET_NAME=svgconvert-net
```

### é˜Ÿåˆ—é…ç½®

```bash
ENABLE_QUEUE_MODE=true
QUEUE_WEBHOOK_SECRET=your-secret
```

### å›è°ƒé…ç½®

```bash
ENABLE_CALLBACK=true
CALLBACK_TIMEOUT_MS=30000
```

---

## ğŸ“ˆ æ€§èƒ½å‚è€ƒ

| æ“ä½œ | å¹³å‡è€—æ—¶ | å¤‡æ³¨ |
|------|---------|------|
| SVG â†’ PNG (1024x768) | 0.5-2s | å–å†³äºå¤æ‚åº¦ |
| PNG â†’ SVG (1024x768) | 1-5s | çŸ¢é‡åŒ–å¤„ç† |
| å°æ–‡ä»¶ä¸Šä¼  (<1MB) | <1s | ç½‘ç»œå»¶è¿Ÿ |
| å¤§æ–‡ä»¶ä¸Šä¼  (20MB) | 5-10s | ç½‘ç»œå»¶è¿Ÿ |
| æ–‡ä»¶ä¸‹è½½ | <1s | ç½‘ç»œå»¶è¿Ÿ |

---

## ğŸ” å®‰å…¨å»ºè®®

- [ ] è®¾ç½® `ALLOWED_ORIGINS` é™åˆ¶ CORS æº
- [ ] åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®ç° API Key è®¤è¯
- [ ] é™åˆ¶ `MAX_FILE_SIZE` é˜²æ­¢æ»¥ç”¨
- [ ] é…ç½®é€Ÿç‡é™åˆ¶ï¼ˆä½¿ç”¨ nginx/cloudflareï¼‰
- [ ] å¯ç”¨ HTTPSï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ï¼‰
- [ ] å®šæœŸæ¸…ç†è¿‡æœŸæ–‡ä»¶
- [ ] ç›‘æ§æœåŠ¡æ—¥å¿—

---

## ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] ä¸Šä¼ å°æ–‡ä»¶æˆåŠŸ
- [ ] ä¸Šä¼ å¤§æ–‡ä»¶å¤±è´¥ï¼ˆ>20MBï¼‰
- [ ] è½¬æ¢çŠ¶æ€è½®è¯¢æ­£å¸¸
- [ ] æ–‡ä»¶ä¸‹è½½æˆåŠŸ
- [ ] æ‰‹åŠ¨æ¸…ç†æˆåŠŸ
- [ ] å›½é™…åŒ–æç¤ºæ­£ç¡®
- [ ] R2 ä¸Šä¼ æˆåŠŸï¼ˆå¦‚å¯ç”¨ï¼‰
- [ ] é˜Ÿåˆ—å¤„ç†æˆåŠŸï¼ˆå¦‚å¯ç”¨ï¼‰
- [ ] é”™è¯¯å¤„ç†å’Œæç¤ºæ¸…æ™°
- [ ] æ€§èƒ½æ»¡è¶³è¦æ±‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´ API æ–‡æ¡£](./API-CN.md) - è¯¦ç»†çš„æ¥å£æ–‡æ¡£
- [åç«¯å¼€å‘æŒ‡å—](./docs/BACKEND_DEVELOPMENT_GUIDE.md) - å¼€å‘æŒ‡å—
- [éƒ¨ç½²æŒ‡å—](./docs/DEPLOYMENT.md) - éƒ¨ç½²è¯´æ˜
- [å¿«é€Ÿå¼€å§‹](./QUICKSTART.md) - å¿«é€Ÿå…¥é—¨

---

## ğŸ”— ç›¸å…³èµ„æº

- **GitHub**: [é¡¹ç›®åœ°å€]
- **Issues**: [é—®é¢˜è¿½è¸ª]
- **è®¨è®º**: [è®¨è®ºåŒº]

æœ€åæ›´æ–°: 2025-01-15
ç‰ˆæœ¬: 1.0.0

